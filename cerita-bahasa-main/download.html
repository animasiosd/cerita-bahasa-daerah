<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Halaman Download Video Cerita</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background-color: #f9f9f9; }
    h1 { text-align: center; margin-bottom: 1rem; }
    .filter-group { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; justify-content: center; }
    select { padding: 0.5rem; font-size: 1rem; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background-color: #eee; }
    tr:hover { background-color: #def; cursor: pointer; }
    @media (max-width: 600px) {
      .filter-group { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body>

  <h1>Download Video Cerita</h1>

  <div class="filter-group">
    <select id="filterBahasa"><option value="">Semua Bahasa</option></select>
    <select id="filterUrutan"><option value="">Semua Urutan</option></select>
    <select id="filterJudul"><option value="">Semua Judul</option></select>
  </div>

  <table id="downloadTable">
    <thead>
      <tr>
        <th>bahasa</th>
        <th>urutan</th>
        <th>title</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyVZHGfb2xf-uPtKzqZ0bD4oIDttsBgF-n_aNXB0-h_Xy-oxYChmT-a4SYDV3MwiUpI/exec';
    let fullData = [];

    async function fetchData() {
      try {
        const res = await fetch(API_URL);
        const json = await res.json();
        if (!Array.isArray(json)) throw new Error("Format data tidak sesuai");
        fullData = json;
        populateFilters(json);
        renderTable(json);
      } catch (err) {
        alert('Gagal memuat data. Pastikan API Google Apps Script sudah dipublikasikan sebagai "Anyone".');
        console.error(err);
      }
    }

    function populateFilters(data) {
      const bahasaSet = new Set();
      const urutanSet = new Set();
      const judulSet = new Set();

      data.forEach(item => {
        bahasaSet.add(item.bahasa);
        urutanSet.add(item.urutan);
        judulSet.add(item.title);
      });

      populateSelect('filterBahasa', [...bahasaSet].sort());
      populateSelect('filterUrutan', [...urutanSet].sort((a, b) => a - b));
      populateSelect('filterJudul', [...judulSet].sort());
    }

    function populateSelect(id, items) {
      const select = document.getElementById(id);
      items.forEach(val => {
        const opt = document.createElement('option');
        opt.value = val;
        opt.textContent = val;
        select.appendChild(opt);
      });
    }

    function renderTable(data) {
      const tbody = document.querySelector('#downloadTable tbody');
      tbody.innerHTML = '';

      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.bahasa}</td>
          <td>${row.urutan}</td>
          <td>${row.title}</td>
        `;
        tr.onclick = () => {
          window.open(row.link_download, '_blank');
        };
        tbody.appendChild(tr);
      });
    }

    function applyFilters() {
      const bahasa = document.getElementById('filterBahasa').value;
      const urutan = document.getElementById('filterUrutan').value;
      const judul = document.getElementById('filterJudul').value;

      const filtered = fullData.filter(item => {
        return (!bahasa || item.Bahasa === bahasa)
            && (!urutan || item.Urutan.toString() === urutan)
            && (!judul || item.Judul === judul);
      });

      renderTable(filtered);
    }

    document.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', applyFilters);
    });

    fetchData();
  </script>

</body>
</html>
